<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A Special Surprise</title>

    <!-- Tailwind (utility layer) -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- Typography -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* ══════════════════════════════════════════════════════════════════════
           STYLES / THEME TOKENS
           ══════════════════════════════════════════════════════════════════════ */
        :root {
            --color-bg: #FDFBF7;
            --color-text-main: #1F2937;
            --color-text-muted: #6B7280;
            --color-accent: #D4A373;

            --flower-stem: #2F6F4E;
            --flower-stem-dark: #1F4F37;
            --flower-leaf: #2F7A55;
            --flower-petal: #E8B9C2;
            --flower-petal-2: #F2CBD3;
            --flower-center: #F4D35E;

            --shadow-soft: 0 16px 40px rgba(17, 24, 39, 0.08);
        }

        body {
            background: var(--color-bg);
            color: var(--color-text-main);
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        h1, h2, h3, .serif {
            font-family: 'Playfair Display', serif;
        }

        /* ══════════════════════════════════════════════════════════════════════
           MODULE SHELL
           ══════════════════════════════════════════════════════════════════════ */
        .module {
            position: absolute;
            inset: 0;
            width: 100%;
            min-height: 100vh;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease-in-out;
            z-index: 0;
            display: none;
        }

        .module.active {
            opacity: 1;
            pointer-events: auto;
            z-index: 10;
        }

        /* ══════════════════════════════════════════════════════════════════════
           MODULE 1 / LANDING (UPDATED WITH LOCK LOGIC)
           ══════════════════════════════════════════════════════════════════════ */
        #landing-module {
            background: radial-gradient(1200px 700px at 25% 15%, rgba(255,255,255,0.55), rgba(255,255,255,0) 60%),
                        linear-gradient(180deg, #eaf2ff 0%, #f6f0ff 45%, #fdfbf7 100%);
            overflow: hidden;
            align-items: center;
            justify-content: center;
        }

        #particles {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .landing-content {
            position: relative;
            z-index: 2;
            text-align: center;
            padding: 0 1rem;
            width: 100%;
            max-width: 600px;
        }

        /* Logic specific styles for locked state */
        .locked-btn {
            background: rgba(220, 38, 38, 0.1) !important;
            border: 1px solid rgba(220, 38, 38, 0.4) !important;
            color: #ef4444 !important;
            cursor: not-allowed !important;
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.72);
            border: 1px solid rgba(17, 24, 39, 0.08);
            padding: 0.95rem 2.35rem;
            border-radius: 999px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            letter-spacing: 0.02em;
            color: #374151;
            cursor: pointer;
            backdrop-filter: blur(8px);
            transition: all 0.25s ease;
            box-shadow: 0 8px 20px rgba(17, 24, 39, 0.08);
            user-select: none;
        }

        .btn-primary:not(.locked-btn):hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 14px 30px rgba(17, 24, 39, 0.12);
        }

        /* ══════════════════════════════════════════════════════════════════════
           MODULE 2 / AUTH
           ══════════════════════════════════════════════════════════════════════ */
        #auth-module {
            background: rgba(17, 24, 39, 0.42);
            backdrop-filter: blur(12px);
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .auth-card {
            background: rgba(255,255,255,0.92);
            border: 1px solid rgba(255,255,255,0.6);
            padding: 2.25rem;
            border-radius: 22px;
            width: 92%;
            max-width: 420px;
            text-align: center;
            box-shadow: var(--shadow-soft);
            transform: scale(0.97);
            opacity: 0;
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #auth-module.active .auth-card {
            transform: scale(1);
            opacity: 1;
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* ══════════════════════════════════════════════════════════════════════
           MODULE 3 / REVEAL
           ══════════════════════════════════════════════════════════════════════ */
        #reveal-module {
            background: radial-gradient(900px 600px at 30% 25%, rgba(250, 204, 21, 0.08), transparent 60%),
                        radial-gradient(900px 600px at 70% 55%, rgba(236, 72, 153, 0.08), transparent 60%),
                        #0B1220;
            align-items: center;
            justify-content: center;
        }

        .reveal-stage {
            transform: translate3d(0, var(--reveal-rand-y, 0px), 0);
            transition: transform 0.6s ease;
            text-align: center;
            padding: 0 1rem;
        }

        .reveal-text {
            font-size: clamp(2.4rem, 5vw, 3.6rem);
            line-height: 1.05;
            letter-spacing: -0.02em;
            filter: drop-shadow(0 18px 30px rgba(0,0,0,0.35));
            text-wrap: balance;
            user-select: none;
        }

        /* Per-letter reveal (random up/down start, settle into place)
           Gradient is applied per-letter to ensure it renders with span-based text. */
        .reveal-letter {
            display: inline-block;
            opacity: 0;
            transform: translateY(var(--dy, 0px)) scale(0.98);
            animation: letterSettle 900ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
            will-change: transform, opacity;

            background: linear-gradient(120deg, #fde68a 0%, #fb7185 40%, #60a5fa 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        /* Add a tiny “pop” feel without being flashy */
        @keyframes letterSettle {
            0% { opacity: 0; transform: translateY(var(--dy, 0px)) scale(0.985); filter: blur(0.2px); }
            60% { opacity: 1; transform: translateY(calc(var(--dy, 0px) * -0.12)) scale(1.01); }
            100% { opacity: 1; transform: translateY(0px) scale(1); filter: blur(0px); }
        }

        /* ══════════════════════════════════════════════════════════════════════
           MODULE 4 / MAIN EXPERIENCE
           ══════════════════════════════════════════════════════════════════════ */
        #main-module {
            position: relative;
            background: radial-gradient(1000px 700px at 55% 10%, rgba(212, 163, 115, 0.12), transparent 60%),
                        linear-gradient(180deg, #ffffff 0%, #fdfbf7 100%);
        }

        /* Flower wrapper keeps the flower centered */
        .flower-wrapper {
            height: min(62vh, 520px);
            width: 100%;
            display: grid;
            place-items: end center;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .flower-anchor {
            width: min(240px, 70vw);
            height: auto;
            overflow: visible;
            filter: drop-shadow(0 18px 26px rgba(17, 24, 39, 0.12));
        }

        /* SVG drawing + bloom */
        .stem-path {
            stroke: url(#stemGrad);
            stroke-width: 5;
            stroke-linecap: round;
            fill: none;
            stroke-dasharray: 520;
            stroke-dashoffset: 520;
            transition: stroke-dashoffset 2.2s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .leaf {
            fill: url(#leafGrad);
            opacity: 0;
            transform-origin: center;
            transform: scale(0.7) translateY(6px);
            transition: opacity 1.1s ease, transform 1.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .petal {
            fill: url(#petalGrad);
            opacity: 0;
            transform-origin: center;
            transform: scale(0.65);
            transition: opacity 1.2s ease, transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .petal.alt {
            fill: url(#petalGrad2);
        }

        .flower-center {
            fill: var(--flower-center);
            opacity: 0;
            transform-origin: center;
            transform: scale(0.6);
            transition: opacity 0.7s ease, transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Trigger classes */
        .grow-stem .stem-path { stroke-dashoffset: 0; }
        .grow-leaves .leaf { opacity: 1; transform: scale(1) translateY(0); }
        .bloom-flower .petal { opacity: 1; transform: scale(1); }
        .bloom-flower .flower-center { opacity: 1; transform: scale(1); }

        .sway {
            transform-origin: 50% 100%;
            animation: sway 6s ease-in-out infinite;
        }

        @keyframes sway {
            0%, 100% { transform: rotate(-0.8deg) translateY(0); }
            50% { transform: rotate(0.8deg) translateY(-2px); }
        }

        /* Panels */
        .content-panel {
            background: rgba(255,255,255,0.92);
            border-radius: 16px;
            border: 1px solid rgba(17, 24, 39, 0.06);
            box-shadow: 0 10px 34px rgba(17, 24, 39, 0.06);
            overflow: hidden;
            opacity: 0;
            transform: translateY(18px);
            transition: opacity 0.9s ease, transform 0.9s ease;
        }

        .panel-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .video-shell {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(17, 24, 39, 0.08);
            background: #0b1220;
        }

        .video-shell video {
            width: 100%;
            height: auto;
            display: block;
        }

        .media-display {
            aspect-ratio: 16/9;
            background: linear-gradient(180deg, #f3f4f6, #f9fafb);
            border-radius: 12px;
            overflow: hidden;
            display: grid;
            place-items: center;
            margin-bottom: 1rem;
            border: 1px solid rgba(17, 24, 39, 0.06);
        }

        .media-display img {

            width: 100%;
            height: 100%;
            object-fit: contain;
            display: none;
        }

        .media-display .active {
        aspect-ratio: 16/9;
            display: block;
            animation: fadeIn 0.35s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .thumbnail-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .thumbnail {
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            opacity: 0.65;
            transition: opacity 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
            border: 2px solid transparent;
            background: #fff;
        }

        .thumbnail:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .thumbnail.active {
            opacity: 1;
            border-color: rgba(47, 111, 78, 0.55);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Quiz */
        .quiz-option {
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
            user-select: none;
        }

        .quiz-option:hover {
            background: #fafafa;
            border-color: #d1d5db;
            transform: translateY(-1px);
        }

        .quiz-option.correct {
            background: #dcfce7;
            border-color: #86efac;
            color: #166534;
        }

        .quiz-option.wrong {
            background: #fee2e2;
            border-color: #fca5a5;
            color: #991b1b;
        }

        /* DevTools guard */
        #devtools-guard {
            opacity: 0;
            transition: opacity 220ms ease;
        }
        #devtools-guard.guard-on {
            display: block !important;
            opacity: 1;
        }

        /* Optional: while guard is on, prevent scroll and selection */
        body.guard-locked {
            overflow: hidden;
            user-select: none;
        }

        @media (prefers-reduced-motion: reduce) {
            * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
            .reveal-letter { opacity: 1 !important; transform: none !important; }
        }
    </style>
</head>
<body>

    <!-- ══════════════════════════════════════════════════════════════════════
         MODULE 1: LANDING (DATE CHECK & RUNAWAY BUTTON)
         ══════════════════════════════════════════════════════════════════════ -->
    <section id="landing-module" class="module active" data-display="flex" style="display: flex;">
        <canvas id="particles"></canvas>
        <div class="landing-content">
            <!-- Dynamic Heading -->
            <h1 id="landing-title" class="serif text-4xl md:text-5xl lg:text-6xl text-gray-900 mb-6 tracking-tight transition-all duration-700">
                Wait for it...
            </h1>

            <!-- Locked Info (Hidden if unlocked) -->
            <div id="landing-locked-info" class="mb-8 hidden transition-opacity duration-700">
                <p class="text-gray-500 text-lg mb-2 serif italic">It is currently:</p>
                <div id="landing-date" class="text-2xl font-mono text-emerald-700 mb-1">--/--/----</div>
                <div id="landing-time" class="text-3xl font-mono text-gray-900 font-bold mb-4">--:--:--</div>
                <p class="text-red-500 text-xs uppercase tracking-widest font-semibold bg-red-50 inline-block px-3 py-1 rounded-full border border-red-100">
                    Access Restricted until <span id="target-date-display">Dec 26</span>
                </p>
            </div>

            <!-- The Button (Logic handles click) -->
            <button id="landing-btn" class="btn-primary">
                LOCKED
            </button>
        </div>
    </section>

    <!-- ══════════════════════════════════════════════════════════════════════
         MODULE 2: AUTHENTICATION
         ══════════════════════════════════════════════════════════════════════ -->
    <section id="auth-module" class="module" data-display="flex" style="display: none;">
        <div class="auth-card">
            <h2 class="serif text-2xl mb-2 text-gray-900"> checking you who are youu??</h2>
            <p class="text-gray-500 mb-6 text-sm">Enter your nickname to unlock</p>

            <input
                type="text"
                id="nickname-input"
                class="w-full px-4 py-3 border border-gray-200 rounded-lg mb-4 text-center focus:outline-none focus:border-gray-400 transition-colors bg-white"
                placeholder="Type here..."
                autocomplete="off"
            />

            <div id="auth-message" class="h-6 text-sm font-medium mb-4 text-red-600 opacity-0 transition-opacity">
                This isn’t for you
            </div>

            <button
                onclick="App.checkNickname()"
                class="w-full bg-gray-900 text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition-colors"
            >
                Unlock
            </button>
        </div>
    </section>

    <!-- ══════════════════════════════════════════════════════════════════════
         MODULE 3: REVEAL
         ══════════════════════════════════════════════════════════════════════ -->
    <section id="reveal-module" class="module" data-display="flex" style="display: none;">
        <div class="reveal-stage">
            <!-- Built dynamically as animated letters (no loading subtitle) -->
            <div id="reveal-title" class="reveal-text serif font-semibold" aria-label="Happy Birthday" role="heading" aria-level="1"></div>
        </div>
    </section>

    <!-- ══════════════════════════════════════════════════════════════════════
         MODULE 4: MAIN EXPERIENCE
         ══════════════════════════════════════════════════════════════════════ -->
    <section id="main-module" class="module" data-display="block" style="display: none;">
        <div class="max-w-7xl mx-auto px-4 py-6 md:py-12 min-h-screen grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- LEFT: WISHES PANEL -->
            <div class="order-2 lg:order-1 flex flex-col justify-center">
                <div id="wishes-panel" class="content-panel p-6 md:p-8">
                    <div id="wishes-video-top" class="mb-5 hidden"></div>

                    <h2 class="serif text-2xl md:text-3xl text-gray-900 mb-5">Happy Birthday to You</h2>
                    <div id="wishes-content" class="text-gray-600 leading-relaxed text-[0.98rem] md:text-[1.02rem]"></div>

                    <div id="wishes-video-bottom" class="mt-6 hidden"></div>
                </div>
            </div>

            <!-- CENTER: FLOWER -->
            <div class="order-1 lg:order-2 relative flex flex-col justify-end items-center">
                <div id="flower-container" class="flower-wrapper">
                    <svg class="flower-anchor" viewBox="0 0 260 520" aria-label="Growing flower" role="img">
                        <defs>
                            <linearGradient id="stemGrad" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="var(--flower-stem)" />
                                <stop offset="100%" stop-color="var(--flower-stem-dark)" />
                            </linearGradient>
                            <linearGradient id="leafGrad" x1="0" y1="0" x2="1" y2="1">
                                <stop offset="0%" stop-color="#3B9A6B" />
                                <stop offset="100%" stop-color="var(--flower-leaf)" />
                            </linearGradient>
                            <radialGradient id="petalGrad" cx="40%" cy="35%" r="70%">
                                <stop offset="0%" stop-color="var(--flower-petal-2)" />
                                <stop offset="100%" stop-color="var(--flower-petal)" />
                            </radialGradient>
                            <radialGradient id="petalGrad2" cx="55%" cy="40%" r="75%">
                                <stop offset="0%" stop-color="#F7D7DD" />
                                <stop offset="100%" stop-color="#E6AEBB" />
                            </radialGradient>
                        </defs>
                        <g id="flower-sway-group">
                            <path class="stem-path" d="M130 510 C128 420 122 340 130 250 C136 175 128 120 130 70" />
                            <path class="leaf" style="transition-delay: 0.5s" d="M123 320 C92 312 68 292 54 262 C78 262 104 282 126 300 C132 306 134 318 123 320 Z" />
                            <path class="leaf" style="transition-delay: 0.65s" d="M137 360 C166 354 194 334 206 304 C182 304 158 322 140 340 C134 346 128 358 137 360 Z" />
                            <path class="leaf" style="transition-delay: 0.8s" d="M120 250 C94 242 76 226 64 206 C86 206 106 218 123 232 C131 238 133 248 120 250 Z" />
                            <path class="leaf" style="transition-delay: 0.95s" d="M142 282 C170 276 192 260 202 238 C180 238 160 250 144 264 C136 270 132 280 142 282 Z" />
                            <g transform="translate(130 68)">
                                <path class="petal" style="transition-delay: 0.15s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(0)" />
                                <path class="petal alt" style="transition-delay: 0.22s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(40)" />
                                <path class="petal" style="transition-delay: 0.29s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(80)" />
                                <path class="petal alt" style="transition-delay: 0.36s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(120)" />
                                <path class="petal" style="transition-delay: 0.43s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(160)" />
                                <path class="petal alt" style="transition-delay: 0.50s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(200)" />
                                <path class="petal" style="transition-delay: 0.57s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(240)" />
                                <path class="petal alt" style="transition-delay: 0.64s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(280)" />
                                <path class="petal" style="transition-delay: 0.71s" d="M0,-14 C10,-38 28,-44 32,-18 C36,6 14,18 0,10 C-14,18 -36,6 -32,-18 C-28,-44 -10,-38 0,-14 Z" transform="rotate(320)" />
                                <circle class="flower-center" cx="0" cy="0" r="12" style="transition-delay: 0.9s" />
                            </g>
                        </g>
                    </svg>
                </div>
            </div>

            <!-- RIGHT: MEDIA + QUIZ -->
            <div class="order-3 lg:order-3 flex flex-col gap-6 justify-center">
                <div id="media-panel" class="content-panel p-5">
                    <h3 class="serif text-xl mb-4 text-gray-900">Memories</h3>
                    <div id="media-stage" class="media-display">
                        <div class="text-gray-400 text-sm">see our photo</div>
                    </div>
                    <div id="media-thumbnails" class="thumbnail-grid"></div>
                </div>

                <div id="quiz-panel" class="content-panel p-5">
                    <h3 class="serif text-xl mb-4 text-gray-900">Quick Quiz</h3>
                    <div id="quiz-content">
                        <div class="flex justify-between text-xs text-gray-400 mb-2">
                            <span>Question <span id="q-current">1</span>/<span id="q-total">3</span></span>
                            <span>Score: <span id="q-score">0</span></span>
                        </div>
                        <div class="w-full bg-gray-100 h-1 rounded-full mb-4 overflow-hidden">
                            <div id="q-progress" class="bg-emerald-500 h-1 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="q-text" class="font-medium text-gray-700 mb-4 text-sm"></p>
                        <div id="q-options" class="space-y-2"></div>
                    </div>
                    <div id="quiz-result" class="hidden text-center py-4">
                        <p class="font-semibold text-gray-900">Quiz Complete</p>
                        <p id="final-score" class="text-sm text-gray-600 mt-1"></p>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Confetti Canvas -->
    <canvas id="confetti" class="fixed top-0 left-0 w-full h-full pointer-events-none z-50"></canvas>

    <!-- DevTools / Inspect Guard Overlay (deterrent, not real security) -->
    <!-- <div id="devtools-guard" class="fixed inset-0 hidden" style="z-index: 9999;">
        <div class="absolute inset-0" style="background: radial-gradient(1100px 700px at 30% 20%, rgba(255,255,255,0.14), rgba(0,0,0,0) 55%), linear-gradient(180deg, rgba(11,18,32,0.92), rgba(11,18,32,0.96));"></div>
        <div class="relative h-full w-full flex items-center justify-center p-6">
            <div class="max-w-md w-full bg-white/10 backdrop-blur-xl border border-white/10 rounded-2xl p-6 text-center shadow-2xl">
                <h2 class="serif text-2xl text-white mb-2">Inspect is disabled</h2>
                <p class="text-white/70 text-sm leading-relaxed">
                    This page is designed to be opened normally. Please close Developer Tools to continue.
                </p>
                <div class="mt-5 text-xs text-white/50">
                    (This is a deterrent only — client-side code cannot truly prevent inspection.)
                </div>
            </div>
        </div>
    </div> -->

    <script>
        /* ══════════════════════════════════════════════════════════════════════
           DATA (EDITABLE)
           ══════════════════════════════════════════════════════════════════════ */
        const DATA = {
            // Configuration for Date Lock
            config: {
                testMode: true,        // Set to false to enforce the date check
                targetMonth: 11,        // 0-indexed (0=Jan, 11=Dec)
                targetDay: 26,          // The day to unlock

                // "Inspect mode" deterrent (cannot be truly secured in client-side web).
                // true  => blocks right-click + common DevTools keys, and shows overlay if DevTools is detected (docked)
                // false => normal behavior
                protectInspect: true
            },

            nicknames: ["bulu"],

            wishes: `
                <h class="mb-4">Happy Birthday Bulu! I hope this little surprise brightens your day.</h>
                <p class="mb-4">You mean the world to me.</p>
                <p class="mb-4">happy bithday bulu. tmelai ma dherai maya garxu ra tme saga kaile ni chutina chahanna kaile ni . you mean a lot for me so i lovee youuu sooo mcuhhh  bulu </p>
                <p class="mb-4"> malai testo dherai kai vanna aaudaina so nairsau hus . and once again happy bithday bulu</p>
                <p class="text-gray-500 italic" your budu</p>

            `,

            video: {
                 placement: "bottom", // "top" or "bottom"
                 title: "Birthday Video",
                 url: "media/a.mp4",
                 poster: "media/1.jpeg" // optional thumbnail image
            },

           media: [
    { type: 'image', url: 'media/1.jpeg', thumb: 'media/1.jpeg', alt: 'Memory 1' },
    { type: 'image', url: 'media/2.jpeg', thumb: 'media/2.jpeg', alt: 'Memory 2' },
    { type: 'image', url: 'media/3.jpeg', thumb: 'media/3.jpeg', alt: 'Memory 3' },
    { type: 'image', url: 'media/4.jpeg', thumb: 'media/4.jpeg', alt: 'Memory 4' },
    { type: 'image', url: 'media/5.jpeg', thumb: 'media/5.jpeg', alt: 'Memory 5' },
    { type: 'image', url: 'media/6.jpeg', thumb: 'media/6.jpeg', alt: 'Memory 6' },
    { type: 'image', url: 'media/7.jpeg', thumb: 'media/7.jpeg', alt: 'Memory 7' },
    { type: 'image', url: 'media/8.jpeg', thumb: 'media/8.jpeg', alt: 'Memory 8' },
    { type: 'image', url: 'media/9.jpeg', thumb: 'media/9.jpeg', alt: 'Memory 9' },
    { type: 'image', url: 'media/10.jpeg', thumb: 'media/10.jpeg', alt: 'Memory 10' },
    { type: 'image', url: 'media/11.jpeg', thumb: 'media/11.jpeg', alt: 'Memory 11' },
    { type: 'image', url: 'media/12.jpeg', thumb: 'media/12.jpeg', alt: 'Memory 12' },
    { type: 'image', url: 'media/13.jpeg', thumb: 'media/13.jpeg', alt: 'Memory 13' },
    { type: 'image', url: 'media/14.jpeg', thumb: 'media/14.jpeg', alt: 'Memory 14' }
],


            quiz: [
                { q: "What is my favorite color?", options: ["Blue", "Green", "Red"], correct: 0 },
                { q: "Where we know each other?", options: ["sanpchat", "instagram", "facebook"], correct: 0 },
                { q: "What year was I born?", options: ["2005", "2003", "2006"], correct: 1 }
            //     { q: "What is my favorite color?", options: ["Blue", "Green", "Red"], correct: 1 },
            //     { q: "Where did we first meet?", options: ["Coffee shop", "Work", "Party"], correct: 0 },
            //     { q: "What’s my comfort food?", options: ["Pizza", "Sushi", "Tacos"], correct: 2 },
            //     { q: "What year was I born?", options: ["1990", "1995", "1998"], correct: 1 }
            ]
        };

        /* ══════════════════════════════════════════════════════════════════════
           APP LOGIC
           ══════════════════════════════════════════════════════════════════════ */
        const App = {
            state: {
                quizIndex: 0,
                quizScore: 0,
                isUnlocked: false,
                hasAttemptedEntry: false, // becomes true after the first locked click
                lastEvasionAt: 0,          // throttle runaway movement
                timerInterval: null,

                // DevTools guard
                devtoolsInterval: null,
                devtoolsOpen: false
            },

            init() {
                Particles.init();
                this.initLanding(); // Logic for date check & runaway button
                this.setupWishes();
                this.setupWishesVideo();
                this.setupMedia();
                this.setupQuiz();
                this.initInspectProtection();

                document.getElementById('nickname-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.checkNickname();
                });
            },

            // --- Inspect / DevTools deterrent (not real security) ---
            initInspectProtection() {
                const cfg = DATA.config || {};
                if (!cfg.protectInspect) return;

                // Block right-click context menu
                document.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                });

                // Block common DevTools shortcuts
                document.addEventListener('keydown', (e) => {
                    const key = (e.key || '').toLowerCase();
                    const ctrl = e.ctrlKey || e.metaKey;
                    const shift = e.shiftKey;

                    // F12
                    if (e.key === 'F12') {
                        e.preventDefault();
                        this.enableDevtoolsGuard(true);
                        return;
                    }

                    // Ctrl+Shift+I/J/C (DevTools)
                    if (ctrl && shift && (key === 'i' || key === 'j' || key === 'c')) {
                        e.preventDefault();
                        this.enableDevtoolsGuard(true);
                        return;
                    }

                    // Ctrl+U (view source)
                    if (ctrl && key === 'u') {
                        e.preventDefault();
                        this.enableDevtoolsGuard(true);
                        return;
                    }

                    // Ctrl+S (save)
                    if (ctrl && key === 's') {
                        e.preventDefault();
                        return;
                    }
                }, { capture: true });

                // Heuristic DevTools detection (docked): window dimension differences
                // + debugger timing check.
                const threshold = 160; // px

                const detect = () => {
                    // 1) Size-based heuristic
                    const wDiff = Math.abs(window.outerWidth - window.innerWidth);
                    const hDiff = Math.abs(window.outerHeight - window.innerHeight);
                    const sizeTriggered = (wDiff > threshold) || (hDiff > threshold);

                    // 2) Debugger timing heuristic
                    const t0 = performance.now();
                    // eslint-disable-next-line no-debugger
                    debugger;
                    const t1 = performance.now();
                    const timeTriggered = (t1 - t0) > 80;

                    const open = sizeTriggered || timeTriggered;
                    if (open !== this.state.devtoolsOpen) {
                        this.state.devtoolsOpen = open;
                        this.enableDevtoolsGuard(open);
                    }
                };

                // Run periodically
                detect();
                this.state.devtoolsInterval = setInterval(detect, 900);

                // Also re-check on resize
                window.addEventListener('resize', () => {
                    // Small delay to let dimensions settle
                    setTimeout(detect, 120);
                });
            },

            enableDevtoolsGuard(on) {
                const overlay = document.getElementById('devtools-guard');
                if (!overlay) return;
                if (on) {
                    overlay.classList.remove('hidden');
                    overlay.classList.add('guard-on');
                    document.body.classList.add('guard-locked');
                } else {
                    overlay.classList.remove('guard-on');
                    overlay.classList.add('hidden');
                    document.body.classList.remove('guard-locked');
                }
            },

            // --- Landing / Date Logic ---
            initLanding() {
                this.checkUnlockStatus();

                // Track pointer location (used to avoid placing the runaway button under the cursor)
                window.__lastPointerPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
                window.addEventListener('mousemove', (e) => {
                    window.__lastPointerPos = { x: e.clientX, y: e.clientY };
                }, { passive: true });
                
                // Update display immediately
                this.updateLandingUI();

                // Start clock tick
                this.updateClock();
                this.state.timerInterval = setInterval(() => {
                    this.updateClock();
                    this.checkUnlockStatus();
                }, 1000);

                const btn = document.getElementById('landing-btn');
                const targetDisplay = document.getElementById('target-date-display');
                
                // Set the display text for target date (simple formatter)
                const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                targetDisplay.innerText = `${monthNames[DATA.config.targetMonth]} ${DATA.config.targetDay}`;

                // Logic: 
                // 1. First click -> Show Alert "Today is not December 26"
                // 2. Subsequent attempts (hover or click) -> Run away
                
                this.state.hasAttemptedEntry = false;

                // After the first attempt, make the button evasive.
                // 1) Hover/touch triggers run away
                btn.addEventListener('mouseenter', () => {
                    if (this.state.hasAttemptedEntry && !this.state.isUnlocked) this.handleRunAway();
                });

                btn.addEventListener('touchstart', () => {
                    if (this.state.hasAttemptedEntry && !this.state.isUnlocked) this.handleRunAway();
                }, { passive: true });

                // 2) Proximity-based evasion: if cursor gets near, it moves away.
                // This makes it very hard to “track” the button with a mouse.
                window.addEventListener('mousemove', (e) => {
                    if (!this.state.hasAttemptedEntry || this.state.isUnlocked) return;
                    const rect = btn.getBoundingClientRect();
                    const cx = rect.left + rect.width / 2;
                    const cy = rect.top + rect.height / 2;
                    const dx = e.clientX - cx;
                    const dy = e.clientY - cy;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    // Trigger when cursor is within a radius around the button
                    const radius = Math.max(110, rect.width * 0.9);
                    if (dist < radius) this.handleRunAway();
                });

                // Click handler
                btn.onclick = () => {
                    if (this.state.isUnlocked) {
                        this.goToAuth();
                        return;
                    }

                    // First time: show message only, then arm the evasive behavior.
                    alert("Today is not December 26");
                    this.state.hasAttemptedEntry = true;

                    // Immediately move once so the next attempts become frustrating.
                    this.handleRunAway();
                };
            },

            checkUnlockStatus() {
                const c = DATA.config;
                if (c.testMode) {
                    this.state.isUnlocked = true;
                } else {
                    const now = new Date();
                    // Simple check: Is it the target month AND is the day >= target day?
                    // Note: This logic assumes current year. If you want strict date (e.g. only Dec 26 2025), logic would need year.
                    // This logic allows it to open if it's PAST the month too, or we can be strict.
                    // React code was: now.getMonth() === TARGET_MONTH && now.getDate() >= TARGET_DAY
                    this.state.isUnlocked = (now.getMonth() === c.targetMonth && now.getDate() >= c.targetDay);
                }
                this.updateLandingUI();
            },

            updateLandingUI() {
                const title = document.getElementById('landing-title');
                const info = document.getElementById('landing-locked-info');
                const btn = document.getElementById('landing-btn');
                
                if (this.state.isUnlocked) {
                    title.innerText = "Midnight Garden"; // Surprise ready title
                    info.classList.add('hidden');
                    
                    btn.innerText = "OPEN SURPRISE";
                    btn.classList.remove('locked-btn');
                    
                    // Reset fixed positioning if it ran away previously
                    btn.style.position = ''; 
                    btn.style.left = '';
                    btn.style.top = '';
                    btn.style.zIndex = '';
                } else {
                    title.innerText = "Wait for it...";
                    info.classList.remove('hidden');
                    btn.innerText = "LOCKED";
                    btn.classList.add('locked-btn');
                }
            },

            updateClock() {
                const now = new Date();
                document.getElementById('landing-date').innerText = now.toLocaleDateString();
                document.getElementById('landing-time').innerText = now.toLocaleTimeString();
            },

            handleRunAway() {
                if (this.state.isUnlocked) return;

                // Throttle to avoid overly-jittery movement on fast mousemove.
                const now = performance.now();
                if (now - this.state.lastEvasionAt < 140) return;
                this.state.lastEvasionAt = now;

                const btn = document.getElementById('landing-btn');
                const w = window.innerWidth;
                const h = window.innerHeight;

                const rect = btn.getBoundingClientRect();
                const bw = Math.max(140, rect.width);
                const bh = Math.max(44, rect.height);

                // Allow it to go basically anywhere, with a little padding so it stays visible.
                const padX = 18;
                const padY = 18;

                const maxX = Math.max(padX, w - bw - padX);
                const maxY = Math.max(padY, h - bh - padY);

                // Avoid placing the button under/near the cursor (so you can’t “camp” it).
                const avoidRadius = 170;
                const pointer = (window.__lastPointerPos || { x: w / 2, y: h / 2 });

                let x = 0;
                let y = 0;
                let tries = 0;
                while (tries < 18) {
                    x = Math.floor(Math.random() * (maxX - padX + 1)) + padX;
                    y = Math.floor(Math.random() * (maxY - padY + 1)) + padY;
                    const cx = x + bw / 2;
                    const cy = y + bh / 2;
                    const dx = pointer.x - cx;
                    const dy = pointer.y - cy;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist > avoidRadius) break;
                    tries++;
                }

                btn.style.position = 'fixed';
                btn.style.left = `${x}px`;
                btn.style.top = `${y}px`;
                btn.style.zIndex = '60';
            },

            // --- Navigation ---
            goToAuth() {
                this.switchModule('landing-module', 'auth-module');
                setTimeout(() => document.getElementById('nickname-input').focus(), 120);
            },

            switchModule(fromId, toId) {
                const from = document.getElementById(fromId);
                const to = document.getElementById(toId);

                from.classList.remove('active');
                setTimeout(() => {
                    from.style.display = 'none';
                    const desiredDisplay = to.dataset.display || 'flex';
                    to.style.display = desiredDisplay;
                    void to.offsetWidth;
                    to.classList.add('active');
                }, 800);
            },

            // --- Authentication ---
            checkNickname() {
                const input = document.getElementById('nickname-input');
                const val = input.value.trim().toLowerCase();
                const valid = DATA.nicknames.map(n => n.toLowerCase()).includes(val);
                const msg = document.getElementById('auth-message');
                const card = document.querySelector('.auth-card');

                if (valid) {
                    msg.style.opacity = '0';
                    Confetti.explode();
                    this.switchModule('auth-module', 'reveal-module');
                    setTimeout(() => this.runRevealSequence(), 900);
                } else {
                    card.classList.add('shake');
                    msg.style.opacity = '1';
                    setTimeout(() => card.classList.remove('shake'), 520);
                }
            },

            // --- Reveal ---
            runRevealSequence() {
                // Build per-letter animated title with random up/down offsets.
                // No “loading experience” subtitle.
                const reveal = document.getElementById('reveal-module');
                const title = document.getElementById('reveal-title');

                // Keep the stage slightly “alive” with a tiny random vertical offset (subtle).
                const stageJitter = Math.floor((Math.random() * 24) - 12); // -12..+12
                reveal.style.setProperty('--reveal-rand-y', `${stageJitter}px`);

                // Clear and rebuild letters every time.
                title.innerHTML = '';

                const phrase = 'Happy Birthday';
                const frag = document.createDocumentFragment();

                // Random offset per letter: small vertical scatter.
                // Use a slightly bigger range for non-space characters, but still subtle.
                const randDy = () => {
                    const magnitude = 18; // px
                    return Math.floor((Math.random() * (magnitude * 2 + 1)) - magnitude); // -18..+18
                };

                let letterIndex = 0;
                for (const ch of phrase) {
                    if (ch === ' ') {
                        const space = document.createElement('span');
                        space.innerHTML = '&nbsp;';
                        frag.appendChild(space);
                        continue;
                    }
                    const span = document.createElement('span');
                    span.className = 'reveal-letter';
                    span.textContent = ch;
                    span.style.setProperty('--dy', `${randDy()}px`);
                    span.style.animationDelay = `${80 + letterIndex * 55}ms`;
                    frag.appendChild(span);
                    letterIndex++;
                }

                title.appendChild(frag);

                // Move on quickly after the animation finishes.
                const totalDuration = 80 + (letterIndex * 55) + 950; // delays + animation
                setTimeout(() => {
                    this.switchModule('reveal-module', 'main-module');
                    this.startMainExperience();
                }, Math.min(3200, totalDuration));
            },

            // --- Main Experience ---
            startMainExperience() {
                setTimeout(() => {
                    const container = document.getElementById('flower-container');
                    const swayGroup = document.getElementById('flower-sway-group');
                    container.classList.add('grow-stem');
                    setTimeout(() => container.classList.add('grow-leaves'), 1450);
                    setTimeout(() => container.classList.add('bloom-flower'), 2200);
                    setTimeout(() => swayGroup.classList.add('sway'), 3400);
                    setTimeout(() => {
                        document.getElementById('wishes-panel').classList.add('panel-visible');
                        document.getElementById('media-panel').classList.add('panel-visible');
                        document.getElementById('quiz-panel').classList.add('panel-visible');
                    }, 2900);
                }, 820);
            },

            // --- Wishes & Video ---
            setupWishes() {
                document.getElementById('wishes-content').innerHTML = DATA.wishes;
            },

            setupWishesVideo() {
                const v = DATA.video;
                if (!v || !v.url) return;
                const mountTop = document.getElementById('wishes-video-top');
                const mountBottom = document.getElementById('wishes-video-bottom');
                const mount = (v.placement === 'top') ? mountTop : mountBottom;
                mount.classList.remove('hidden');
                mount.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <p class="text-xs font-semibold text-gray-700 uppercase tracking-wider">${this.escapeHTML(v.title || 'Video')}</p>
                        <p class="text-xs text-gray-400">Click to play</p>
                    </div>
                    <div class="video-shell">
                        <video controls preload="metadata" playsinline poster="${this.escapeAttr(v.poster || '')}">
                            <source src="${this.escapeAttr(v.url)}" type="video/mp4" />
                            Your browser does not support the video tag.
                        </video>
                    </div>
                `;
            },

            // --- Media ---
            setupMedia() {
                const grid = document.getElementById('media-thumbnails');
                grid.innerHTML = '';
                const images = DATA.media.filter(m => m.type === 'image');
                images.forEach((item, index) => {
                    const thumb = document.createElement('button');
                    thumb.type = 'button';
                    thumb.className = 'thumbnail';
                    thumb.setAttribute('aria-label', item.alt || `Photo ${index + 1}`);
                    thumb.innerHTML = `<img src="${item.thumb}" alt="${this.escapeAttr(item.alt || '')}">`;
                    thumb.onclick = () => this.showMedia(item, thumb);
                    grid.appendChild(thumb);
                });
                if (images.length > 0) this.showMedia(images[0], grid.children[0]);
            },

            showMedia(item, thumbElement) {
                const stage = document.getElementById('media-stage');
                document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                thumbElement.classList.add('active');
                stage.innerHTML = '';
                const img = document.createElement('img');
                img.src = item.url;
                img.alt = item.alt || 'Selected photo';
                img.className = 'active';
                stage.appendChild(img);
            },

            // --- Quiz ---
            setupQuiz() {
                this.state.quizIndex = 0;
                this.state.quizScore = 0;
                this.renderQuestion();
            },

            renderQuestion() {
                const q = DATA.quiz[this.state.quizIndex];
                if (!q) return this.endQuiz();
                document.getElementById('q-current').innerText = this.state.quizIndex + 1;
                document.getElementById('q-total').innerText = DATA.quiz.length;
                document.getElementById('q-score').innerText = this.state.quizScore;
                document.getElementById('q-text').innerText = q.q;
                const progress = (this.state.quizIndex / DATA.quiz.length) * 100;
                document.getElementById('q-progress').style.width = `${progress}%`;
                const opts = document.getElementById('q-options');
                opts.innerHTML = '';
                opts.classList.remove('locked');
                q.options.forEach((optText, i) => {
                    const btn = document.createElement('div');
                    btn.className = 'quiz-option text-sm';
                    btn.innerText = optText;
                    btn.onclick = () => this.handleAnswer(btn, i, q.correct);
                    opts.appendChild(btn);
                });
            },

            handleAnswer(btn, index, correctIndex) {
                const parent = btn.parentNode;
                if (parent.classList.contains('locked')) return;
                parent.classList.add('locked');
                if (index === correctIndex) {
                    btn.classList.add('correct');
                    this.state.quizScore++;
                } else {
                    btn.classList.add('wrong');
                    parent.children[correctIndex].classList.add('correct');
                }
                setTimeout(() => {
                    this.state.quizIndex++;
                    this.renderQuestion();
                }, 950);
            },

            endQuiz() {
                document.getElementById('quiz-content').classList.add('hidden');
                const res = document.getElementById('quiz-result');
                res.classList.remove('hidden');
                document.getElementById('final-score').innerText = `You scored ${this.state.quizScore} / ${DATA.quiz.length}`;
                document.getElementById('q-progress').style.width = '100%';
            },

            escapeHTML(str) {
                return String(str).replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('"', '&quot;').replaceAll("'", '&#039;');
            },
            escapeAttr(str) { return this.escapeHTML(str); }
        };

        /* ══════════════════════════════════════════════════════════════════════
           VISUAL EFFECTS
           ══════════════════════════════════════════════════════════════════════ */
        const Particles = {
            init() {
                const canvas = document.getElementById('particles');
                const ctx = canvas.getContext('2d');
                let width, height;
                let particles = [];
                const resize = () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                };
                window.addEventListener('resize', resize);
                resize();
                const count = 44;
                particles = Array.from({ length: count }).map(() => ({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.28,
                    vy: (Math.random() - 0.5) * 0.22,
                    r: Math.random() * 2.1 + 0.7,
                    a: Math.random() * 0.22 + 0.08
                }));
                const animate = () => {
                    ctx.clearRect(0, 0, width, height);
                    particles.forEach(p => {
                        p.x += p.vx;
                        p.y += p.vy;
                        if (p.x < -20) p.x = width + 20;
                        if (p.x > width + 20) p.x = -20;
                        if (p.y < -20) p.y = height + 20;
                        if (p.y > height + 20) p.y = -20;
                        ctx.beginPath();
                        ctx.fillStyle = `rgba(255,255,255,${p.a})`;
                        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    requestAnimationFrame(animate);
                };
                animate();
            }
        };

        const Confetti = {
            explode() {
                const canvas = document.getElementById('confetti');
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                const pieces = [];
                const colors = ['#fde68a', '#fb7185', '#60a5fa', '#34d399'];
                for (let i = 0; i < 120; i++) {
                    pieces.push({
                        x: canvas.width / 2,
                        y: canvas.height / 2,
                        vx: (Math.random() - 0.5) * 18,
                        vy: (Math.random() - 0.8) * 18,
                        w: Math.random() * 7 + 3,
                        h: Math.random() * 10 + 4,
                        rot: Math.random() * Math.PI,
                        vr: (Math.random() - 0.5) * 0.2,
                        color: colors[(Math.random() * colors.length) | 0],
                        life: 1
                    });
                }
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    let active = false;
                    pieces.forEach(p => {
                        if (p.life <= 0) return;
                        active = true;
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.45;
                        p.rot += p.vr;
                        p.life -= 0.018;
                        ctx.save();
                        ctx.globalAlpha = Math.max(0, p.life);
                        ctx.translate(p.x, p.y);
                        ctx.rotate(p.rot);
                        ctx.fillStyle = p.color;
                        ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                        ctx.restore();
                    });
                    if (active) requestAnimationFrame(animate);
                    else ctx.clearRect(0, 0, canvas.width, canvas.height);
                };
                animate();
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
